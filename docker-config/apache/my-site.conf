<VirtualHost *:80>
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html/public

    # On active le moteur de réécriture
    RewriteEngine On
    
    # On définit les en-têtes CORS pour autoriser notre frontend
    Header always set Access-Control-Allow-Origin "${CORS_ALLOWED_ORIGINS}"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept, Authorization"
    Header always set Access-Control-Allow-Credentials "true"

    # On répond aux requêtes de "permission" OPTIONS
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ $1 [R=204,L]

    # On applique la règle de routage principale de Laravel
    # Si la requête ne correspond ni à un fichier ni à un dossier...
    <Directory /var/www/html/public>
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteCond %{REQUEST_FILENAME} !-f
        # ...on la redirige vers index.php
        RewriteRule ^ /index.php [L]
    </Directory>

</VirtualHost>